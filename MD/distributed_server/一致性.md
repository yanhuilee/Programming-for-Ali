#### 数据库和缓存双写一致性

- 先删除缓存，再更新数据库
```
// 延时双删策略，将1秒内所造成的缓存脏数据，再次删除
void write(String key,Object data){
    redis.delKey(key);
    db.updateData(data);
    Thread.sleep(1000);
    redis.delKey(key);  //异步删除，成功发送消息立即返回
}
```


上述情形，就是数据不一致的原因。还是使用双删延时策略。只是，睡眠时间修改为在主从同步的延时时间基础上，加几百ms。

##### 为什么数据会不一致
（1）单库情况下，服务层的并发读写，缓存与数据库的操作交叉进行

后发起的请求B在先发起的请求A中间完成了

（2）主从同步，读写分离的情况下，读从库读到旧数据

