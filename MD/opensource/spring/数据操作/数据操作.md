### 大纲
```
JDBC 数据源：DataSource
事务抽象
JdbcTemplate query()
SpringBoot 如何配置多数据源
连接池：Druid 监控，DruidDataSource，Filter
常用注解：@Repository
异常抽象：DataAccessException
	错误码 ErrorCode
ORM: Spring Data
	MyBatis:
		@MapperScan @Mapper
		plugins
		PageHelper
```

事务抽象
```
PlatformTransactionManager
TransactionDefinition
传播特性
隔离特性
声明式事务
@Transactional
```

#### 配置
```
// jdbc
spring-boot-starter-jdbc: HikariCP
@Repository
```

- 数据源：DataSource
- 事务：PlatformTransactionManager（DataSourceTransactionManager）/ TransactionTemplate
- 操作：JdbcTemplate

```
// springboot 配置
DataSourceAutoConfiguration
DataSourceTransactionManagerAutoConfigu
JdbcTemplateAutoConfiguration
```

#### 多数据源

```java
// 不同数据源的配置要分开
// 有多个DataSource 时系统如何判断
@Primary

@Bean
@ConfigurationProperties("foo.datasource")
public DataSourceProperties fooDataSourceProperties() {
    return new DataSourceProperties();
}

@Bean
public DataSource fooDataSource() {
    DataSourceProperties dataSourceProperties = fooDataSourceProperties();
    log.info("foo datasource: {}", dataSourceProperties.getUrl());
    return dataSourceProperties.initializeDataSourceBuilder().build();
}
```

#### 连接池 Druid，为监控而生
- 详细的监控
- ExceptionSorter，支持主流数据库的返回码
- SQL 防注入
- 内置加密配置
- 内置Logging能诊断Hack应用行为

```
druid-spring-boot-starter
DruidDataSource

// Filter
FilterEventAdapter
META-INF/druid-filter.properties
```

- StatFilter
 ```
<dataSource>
 	filters = stat, log4j
  	logslowsql = true
 ```

- StatViewServlet
- WallFilter sql注入
- ConfigFilter 加密

#### JDBC 异常抽象
Spring 会将数据操作的异常转换为 DataAccessException

Spring 如何认识那些错误码：SQLErrorCodeExceptionTranslator

根据数据库错误码来定制异常


### O/R Mapping 实践
Spring Data JPA/Redis

```
spring.jpa.hibernate.ddl-auto=none
spring.jpa.properties.hibernate.show_sql=true
spring.jpa.properties.hibernate.format_sql=true
```

---
@Slf4j
lombok
CommandLineRunner
joda