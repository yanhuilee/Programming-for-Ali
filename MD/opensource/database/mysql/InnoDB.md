> InnoDB是基于多版本并发控制的存储引擎

### MVCC实现原理

> MVCC就是通过"读取旧版本数据"(undo日志)来降低并发事务的锁冲突，提高任务的并发度



###### MyIsam 和 InnoDB 区别
- `count(*)`: MyIsam会直接存储总行数，InnoDB按行扫描
- 全文索引
- 事务
- 外键
- 表锁与行锁
- MyIsam会把自增主键的最大ID记录到数据文件，InnoDB记录到内存

InnoDB的行锁是实现在索引上的，如果没有命中索引，也无法使用行锁，将要退化为表锁

#### InnoDB 行锁机制
默认隔离级别： Repeated Read
- 读取到的数据，都是其他事务已提交数据
- 同一个事务，相同的连续读，得到的结果应该是相同的
- 不会出现insert幻读

#### 并发控制，锁，事务模型
共享锁与排他锁


#### MVCC 多版本并发控制
- 普通锁：本质是串行执行
- 读写锁：可以实现读读并发
- 数据多版本：可以实现读写并发（写新版本同时可以读旧版本）

---

#### 核心军规
- 数据库做运算
- 单表数量：500w
- 范式与冗余
- 3B：大sql，大事务，大批量

#### 索引类军规
- 字段必须建前缀索引
- 索引列做运算
- 不用外键，由程序保证约束

#### SQL类军规
- 保持事务（连接）矮小：用完即关；减少锁资源占用；eg: 图片上传等
- 少用存储过程，触发器
- 不用*
- in/union(不同字段) or
- 避免负向查询和 %前缀模糊查询
- limit分页改为 `where id > xx limit 11`
- 同数据类型的列值比较
- load data 导数据

Btree 分裂
in和exists
自增主键可能的问题

分库分表，中间件，sharding-jdbc
主从延迟怎么解决
